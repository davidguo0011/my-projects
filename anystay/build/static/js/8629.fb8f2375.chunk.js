"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="2787eb79-a448-5021-bfc3-748ef2de1c9a")}catch(e){}}();
(self.webpackChunkanystay_dev=self.webpackChunkanystay_dev||[]).push([[8629],{8629:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var o=n(5043),i=n(7986),l=n(1869),r=n(831),s=n(3216),a=n(4936),d=n(1852),c=n(579);function u(e){let{listingOwnerData:t,bookingRequest:n}=e;const[o,u]=(0,r.useRecoilState)(l.e),g=(0,s.Zp)();return(0,c.jsxs)(i.tL,{children:[(0,c.jsx)(d.A,{onClick:()=>{g(`/your-inbox/${o.id}`)},type:"Arrow"}),t&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.yC,{children:t.firstName}),(0,c.jsx)(i.Hq,{href:`tel:${t.phone}`,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,c.jsx)("path",{d:"M21.6858 16.5986C21.6652 16.478 21.6385 16.3585 21.6058 16.2406C21.5132 15.9282 21.3338 15.6485  21.0884 15.4342C20.843 15.2198 20.5418 15.0795 20.2198 15.0296L15.8878 14.3086C15.5777  14.2551 15.2588 14.2865 14.965 14.3993C14.6712 14.5121 14.4134 14.7023 14.2188  14.9496C14.1648 15.0186 14.1128 15.0886 14.0648 15.1606C14.0296 15.2225 13.9736 15.2698  13.9067 15.2942C13.8399 15.3186 13.7665 15.3184 13.6998 15.2936C11.4577 14.3238 9.66961  12.5358 8.69981 10.2936C8.67581 10.2279 8.67557 10.1558 8.69913 10.0898C8.72269 10.0239 8.76857  9.9683 8.82881 9.93264C8.92381 9.86864 9.01481 9.80064 9.10481 9.73264C9.34463 9.53754 9.5291  9.28298 9.63982 8.99434C9.75054 8.70569 9.78364 8.39306 9.73581 8.08764L9.06781 3.83164C9.02021  3.5149 8.88591 3.2175 8.67977 2.97236C8.47363 2.72721 8.20369 2.54388 7.89981 2.44264C7.73374  2.38819 7.56397 2.34574 7.39181 2.31564C6.76329 2.20436 6.11785 2.23487 5.50263 2.40493C4.88741 2.575 4.31794 2.88034 3.83581 3.29864C3.3221 3.73777 2.91321 4.28633 2.63911 4.90407C2.36502  5.52182 2.23269 6.19308 2.25181 6.86864C2.35658 10.7805 3.95707 14.5034 6.7238 17.2709C9.49054  20.0383 13.213 21.6398 17.1248 21.7456C17.1658 21.7456 17.2068 21.7456 17.2478 21.7456C17.8993  21.7457 18.5432 21.6049 19.1352 21.3328C19.7272 21.0608 20.2535 20.664 20.6778 20.1696C21.1009  19.6869 21.4109 19.1158 21.5853 18.498C21.7596 17.8803 21.794 17.2314 21.6858 16.5986ZM19.5438  19.1916C19.2482 19.5303 18.882 19.8002 18.4711 19.9825C18.0601 20.1647 17.6143 20.2549 17.1648  20.2466C13.6372 20.151 10.2805 18.7069 7.78528 16.2115C5.29008 13.7161 3.84623 10.3592 3.75081  6.83164C3.73845 6.379 3.82739 5.92931 4.01113 5.51546C4.19487 5.1016 4.46877 4.73404 4.81281  4.43964C5.31554 3.99663 5.96176 3.75079 6.63181 3.74764C6.79944 3.74773 6.96674 3.76245 7.13181 3.79164C7.23342  3.80969 7.33366 3.83475 7.43181 3.86664C7.47421 3.88202 7.51152 3.90886 7.53958 3.94416C7.56765  3.97947 7.58539 4.02186 7.59081 4.06664L8.26181 8.32164C8.26893 8.36664 8.26419 8.41273 8.24806  8.45534C8.23193 8.49796 8.20496 8.53563 8.16981 8.56464C8.11181 8.61164 8.05281 8.65564 7.99181 8.69764C7.63908 8.92679 7.37907 9.27363 7.25804 9.67647C7.137 10.0793 7.16279 10.512 7.33081  10.8976C8.45164 13.484 10.514 15.5475 13.0998 16.6696C13.4861 16.8353 13.9183 16.8596 14.3207  16.7382C14.7231 16.6167 15.0697 16.3574 15.2998 16.0056C15.3298 15.9616 15.3608 15.9186 15.3948  15.8756C15.4241 15.8411 15.462 15.8147 15.5046 15.7993C15.5472 15.7839 15.5932 15.7798 15.6378  15.7876L19.9698 16.5086C20.0105 16.5126 20.0494 16.5274 20.0825 16.5515C20.1156 16.5756 20.1416  16.6081 20.1578 16.6456C20.1748 16.7076 20.1908 16.7766 20.2048 16.8556C20.2748 17.2697 20.2519  17.6941 20.1375 18.0981C20.0232 18.5022 19.8204 18.8757 19.5438 19.1916Z",fill:n.completed?a.J2.Black.color:a.J2.Grey1.color})})})]})]})}function g(e){let{listingOwnerData:t,bookingRequest:n}=e;return t?(0,c.jsxs)(i.Ov,{children:[(0,c.jsx)("div",{children:(0,c.jsx)(i.Hm,{children:t.firstName})}),(0,c.jsx)(i.NG,{href:n.completed?`tel:${t.phone}`:void 0,children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,c.jsx)("path",{d:"M21.6858 16.5986C21.6652 16.478 21.6385 16.3585 21.6058 16.2406C21.5132 15.9282 21.3338 15.6485  21.0884 15.4342C20.843 15.2198 20.5418 15.0795 20.2198 15.0296L15.8878 14.3086C15.5777  14.2551 15.2588 14.2865 14.965 14.3993C14.6712 14.5121 14.4134 14.7023 14.2188  14.9496C14.1648 15.0186 14.1128 15.0886 14.0648 15.1606C14.0296 15.2225 13.9736 15.2698  13.9067 15.2942C13.8399 15.3186 13.7665 15.3184 13.6998 15.2936C11.4577 14.3238 9.66961  12.5358 8.69981 10.2936C8.67581 10.2279 8.67557 10.1558 8.69913 10.0898C8.72269 10.0239 8.76857  9.9683 8.82881 9.93264C8.92381 9.86864 9.01481 9.80064 9.10481 9.73264C9.34463 9.53754 9.5291  9.28298 9.63982 8.99434C9.75054 8.70569 9.78364 8.39306 9.73581 8.08764L9.06781 3.83164C9.02021  3.5149 8.88591 3.2175 8.67977 2.97236C8.47363 2.72721 8.20369 2.54388 7.89981 2.44264C7.73374  2.38819 7.56397 2.34574 7.39181 2.31564C6.76329 2.20436 6.11785 2.23487 5.50263 2.40493C4.88741 2.575 4.31794 2.88034 3.83581 3.29864C3.3221 3.73777 2.91321 4.28633 2.63911 4.90407C2.36502  5.52182 2.23269 6.19308 2.25181 6.86864C2.35658 10.7805 3.95707 14.5034 6.7238 17.2709C9.49054  20.0383 13.213 21.6398 17.1248 21.7456C17.1658 21.7456 17.2068 21.7456 17.2478 21.7456C17.8993  21.7457 18.5432 21.6049 19.1352 21.3328C19.7272 21.0608 20.2535 20.664 20.6778 20.1696C21.1009  19.6869 21.4109 19.1158 21.5853 18.498C21.7596 17.8803 21.794 17.2314 21.6858 16.5986ZM19.5438  19.1916C19.2482 19.5303 18.882 19.8002 18.4711 19.9825C18.0601 20.1647 17.6143 20.2549 17.1648  20.2466C13.6372 20.151 10.2805 18.7069 7.78528 16.2115C5.29008 13.7161 3.84623 10.3592 3.75081  6.83164C3.73845 6.379 3.82739 5.92931 4.01113 5.51546C4.19487 5.1016 4.46877 4.73404 4.81281  4.43964C5.31554 3.99663 5.96176 3.75079 6.63181 3.74764C6.79944 3.74773 6.96674 3.76245 7.13181 3.79164C7.23342  3.80969 7.33366 3.83475 7.43181 3.86664C7.47421 3.88202 7.51152 3.90886 7.53958 3.94416C7.56765  3.97947 7.58539 4.02186 7.59081 4.06664L8.26181 8.32164C8.26893 8.36664 8.26419 8.41273 8.24806  8.45534C8.23193 8.49796 8.20496 8.53563 8.16981 8.56464C8.11181 8.61164 8.05281 8.65564 7.99181 8.69764C7.63908 8.92679 7.37907 9.27363 7.25804 9.67647C7.137 10.0793 7.16279 10.512 7.33081  10.8976C8.45164 13.484 10.514 15.5475 13.0998 16.6696C13.4861 16.8353 13.9183 16.8596 14.3207  16.7382C14.7231 16.6167 15.0697 16.3574 15.2998 16.0056C15.3298 15.9616 15.3608 15.9186 15.3948  15.8756C15.4241 15.8411 15.462 15.8147 15.5046 15.7993C15.5472 15.7839 15.5932 15.7798 15.6378  15.7876L19.9698 16.5086C20.0105 16.5126 20.0494 16.5274 20.0825 16.5515C20.1156 16.5756 20.1416  16.6081 20.1578 16.6456C20.1748 16.7076 20.1908 16.7766 20.2048 16.8556C20.2748 17.2697 20.2519  17.6941 20.1375 18.0981C20.0232 18.5022 19.8204 18.8757 19.5438 19.1916Z",fill:n.completed?a.J2.Black.color:a.J2.Grey1.color})})})]}):null}var h=n(6879);function v(e){let{bookingRequest:t,conversation:n,listingData:l}=e;const r=(0,s.Zp)(),a=e=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e],d=(0,o.useMemo)((()=>{if(l)return JSON.parse(l.listingImages[0]).key}),[l]);return t&&n&&l?(0,c.jsxs)(i.qj,{type:"button",onClick:()=>{t.completed?r(`/your-booking/${t.id}`):r(`/listing/${t.listingmodelID}`)},children:[(0,c.jsx)(i._o,{src:(0,h.A)(d,800),alt:"Picture of listing model"}),(0,c.jsxs)(i.XM,{children:[(0,c.jsx)(i.FV,{children:`${l.propertyTitle.substring(0,15)}${l.propertyTitle.split("").length>15?"...":""}`}),(0,c.jsxs)(i.rc,{confirmed:"Requested"!==n.status,children:[n?n.status:""," \u2022 ",(()=>{let e=new Date(t.arrivalDate.replace("Z",""));return`${e.getDate()} ${a(e.getMonth())}`})()," - ",(()=>{let e=new Date(t.departureDate.replace("Z",""));return`${e.getDate()} ${a(e.getMonth())}`})()," "]})]})]}):null}function x(e){var t,n;let{conversation:l}=e;const{id:r}=(0,s.g)(),[a,d]=(0,o.useState)("https://d292awxalydr86.cloudfront.net/Settings+page/Profile+photo+placeholder.png");(0,o.useEffect)((()=>{var e,t;if(null!==l&&void 0!==l&&null!==(e=l.BookingRequestModel)&&void 0!==e&&null!==(t=e.ListingModel)&&void 0!==t&&t.listingImages){const e=(0,h.A)(JSON.parse(l.BookingRequestModel.ListingModel.listingImages[0]).key,300);d(e)}}),[l]);const u=e=>{if(l.BookingRequestModel){let n=new Date(e);return`${n.getUTCDate()} ${t=n.getMonth(),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t]}`}return"";var t};return(0,c.jsxs)(i.p1,{to:`/conversation/${l.id}`,selected:l.id===r,children:[(0,c.jsx)(i.xM,{src:a,alt:"Photo for listing owner"}),(0,c.jsxs)(i.zW,{children:[(0,c.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"},children:[(0,c.jsx)(i.Mq,{children:null===(t=l.UserHostModel)||void 0===t||null===(n=t.UserModel)||void 0===n?void 0:n.firstName}),l.BookingRequestModel&&(0,c.jsx)(i.ff,{children:(()=>{let e=new Date(l.updatedAt),t=((new Date).getTime()-e.getTime())/1e3/60/60;return t>24?`${Math.floor(t/24)}d`:t<1?`${Math.floor(60*t)}m`:`${Math.floor(t)}h`})()})]}),(0,c.jsx)(i.Mq,{children:(()=>{const e=e=>e.length>25?e.substring(0,25)+"...":e;return 0===l.MessageModels.items.length?null:null!==l.MessageModels.items[0].body?e(l.MessageModels.items[0].body):null!==l.MessageModels.items[0].guestNoteBody?e(l.MessageModels.items[0].guestNoteBody):void 0})()}),(0,c.jsx)(i.ff,{children:(()=>{var e,t;let n=`${(()=>{var e,t,n,o,i;return null!==l&&void 0!==l&&null!==(e=l.BookingRequestModel)&&void 0!==e&&e.declined?"Declined":null!==l&&void 0!==l&&null!==(t=l.BookingRequestModel)&&void 0!==t&&t.cancelled?"Cancelled":null!==l&&void 0!==l&&null!==(n=l.BookingRequestModel)&&void 0!==n&&n.completed?null!==l&&void 0!==l&&null!==(o=l.BookingRequestModel)&&void 0!==o&&o.confirmed?"Confirmed":null!==l&&void 0!==l&&null!==(i=l.BookingRequestModel)&&void 0!==i&&i.expired?"Expired":"Requested":"Enquiry"})()} \u2022 ${u(null===l||void 0===l||null===(e=l.BookingRequestModel)||void 0===e?void 0:e.arrivalDate)} - ${u(null===l||void 0===l||null===(t=l.BookingRequestModel)||void 0===t?void 0:t.departureDate)}`;return n.length>44?`${n.slice(0,40)}...`:n})()})]})]})}var p=n(9138),m=n(8297),y=n(6546),f=n(2945),C=n(7426);function j(e){let{accessToken:t}=e;const n=(0,o.useRef)(null),s=(0,o.useRef)(!1),a=(0,o.useRef)(null),[d,u]=(0,o.useState)(!1),[g,h]=(0,o.useState)([]),[v,j]=(0,r.useRecoilState)(l.e),[w,b]=(0,o.useState)(!1),D=e=>[...e.sort(((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))],M=(0,o.useCallback)((async e=>{m.n.graphql((0,y.D)(f.mE,{messageownerID:e})).subscribe({next:e=>{let{provider:t,value:n}=e;h((e=>{const t=n.data.onUpdateConversationByMessageOwnerID,o=e.map((e=>e.id===t.id?{...e,MessageModels:t.MessageModels,updatedAt:(new Date).toISOString(),status:t.status}:e));return D(o)}))},error:e=>console.warn(e)})}),[]),k=(0,o.useCallback)((async()=>{await(0,C.p)("post","dev-anystay-user","user/guest/conversations",{headers:{Authorization:t},body:{nextToken:null}}).then((e=>{var t;(console.log(e),e.success)&&(a.current=e.body.nextToken,h(null===(t=e.body)||void 0===t?void 0:t.conversations))}))}),[t]),T=(0,o.useCallback)((async e=>{s.current=!0,await(0,C.p)("post","dev-anystay-user","user/guest/conversations",{headers:{Authorization:t},body:{nextToken:e}}).then((e=>{console.log(e),e.success&&(a.current=e.body.nextToken,u(!1),h((t=>D([...t,...e.body.conversations]))),s.current=!1)})).catch((e=>console.log(e)))}),[t]),A=(0,o.useCallback)((()=>{if((()=>{var e,t;return(null===(e=n.current)||void 0===e?void 0:e.scrollHeight)>(null===(t=n.current)||void 0===t?void 0:t.clientHeight)})()&&!s.current){var e,t,o;if(null===a.current)return;u(Math.ceil(null===(e=n.current)||void 0===e?void 0:e.scrollTop)+(null===(t=n.current)||void 0===t?void 0:t.clientHeight)>=(null===(o=n.current)||void 0===o?void 0:o.scrollHeight))}}),[]);return(0,o.useEffect)((()=>{if(!w){const{current:e}=n;return null===e||void 0===e||e.addEventListener("scroll",A),()=>{null===e||void 0===e||e.removeEventListener("scroll",A)}}}),[A,w]),(0,o.useEffect)((()=>{d&&a.current&&(console.log("fetch more conversation"),T(a.current))}),[T,d]),(0,o.useEffect)((()=>{(async()=>{b(!0),await k(),await M(v.id),b(!1)})()}),[k,M,v]),(0,c.jsxs)(i.FO,{ref:n,children:[(0,c.jsx)(i.g5,{children:"Inbox"}),(0,c.jsxs)(i.pb,{children:[g.map((e=>(0,c.jsx)(x,{conversation:e},e.id))),d&&(0,c.jsx)(i.Yy,{children:(0,c.jsx)(p.A,{})})]})]})}var w=n(2119);const b=w.Ay.div`
    grid-row: 1/4;
    grid-column: 3/4;
    height: 100%;
    width: 100%;
    border-left: 1px solid ${a.J2.Grey2.color};
    padding: 44px 32px;
    padding-top: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    @media (max-width: 1280px) {
        display: none;
    }
`;function D(){return(0,c.jsx)(b,{children:(0,c.jsx)(p.A,{style:{width:"50px",height:"50px"}})})}function M(e){let{bookingRequest:t,listingOwnerData:n,listingData:l,guestPriceBreakdown:r,loadingPage:a}=e;const{id:d}=(0,s.g)(),u=(0,s.Zp)(),[g,v]=(0,o.useState)(!1),[x,p]=(0,o.useState)(!1),[m,y]=(0,o.useState)(!1),f=(0,o.useRef)(null),C=e=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e],j=e=>{if(e<100||e>2400)return null;return`${1200===e||2400===e?12:e/100%12}:00${e>1100&&e<2400?"pm":"am"}`},w=()=>{if(t)return t.declined?"Declined":t.cancelled?"Cancelled":t.completed?t.confirmed?"Confirmed":t.expired?"Expired":"Requested":"Enquiry"},b=()=>{if(x||m)return(0,c.jsx)(i.Ss,{children:"Change"});if(t){if(!t.completed&&!t.cancelled)return(0,c.jsx)(i.cT,{to:`/complete-booking/${t.id}`,children:"Change"});if(t.confirmed&&!t.cancelled)return(0,c.jsx)(i.cT,{to:`/change-your-booking/${t.id}`,children:"Change"})}return(0,c.jsx)(i.Ss,{children:"Change"})},M=(0,o.useCallback)((async()=>{let e=!1;t&&t.ChangeBookingRequestModel.items.length>0&&t.ChangeBookingRequestModel.items.map(((t,n)=>(t.completed||(e=!0),null))),e&&p(!0)}),[t]),k=(0,o.useCallback)((async()=>{let e=!1;t&&t.RefundRequestModel.items.length>0&&t.RefundRequestModel.items.map(((t,n)=>(t.completed||(e=!0),null))),e&&y(!0)}),[t]);return(0,o.useEffect)((()=>{var e;null===(e=f.current)||void 0===e||e.scrollTo({top:0}),M(),k()}),[M,k,d]),a?(0,c.jsx)(D,{}):t&&n&&l&&r?(0,c.jsxs)(i.ft,{ref:f,children:[(0,c.jsx)(i.Bw,{children:(0,c.jsx)(i.Vv,{children:w()})}),(0,c.jsx)(i.cx,{type:"button",onClick:()=>u(`/listing/${t.listingmodelID}`),children:(0,c.jsx)(i.W7,{src:(0,h.A)(JSON.parse(l.listingImages[0]).key,800),alt:""})}),(0,c.jsx)(i.Rc,{children:l.propertyTitle}),(0,c.jsxs)(i.p8,{children:[(e=>{switch(e){case"entire-place":return"Entire home";case"private-room":return"Private room";case"shared-room":return"Shared room"}})(l.typeOfPlace)," in ",l.suburb]}),(0,c.jsx)(i.av,{children:t.completed?(0,c.jsx)(i.Hb,{to:`/your-booking/${t.id}`,children:"Details"}):(0,c.jsx)(i.E4,{to:`/complete-booking/${t.id}`,children:"Complete booking"})}),(0,c.jsxs)(i.VS,{children:[(0,c.jsxs)("div",{style:{gridColumn:"1/2",gridRow:"1/2",display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Arrive"}),(0,c.jsx)(i.yt,{children:(()=>{if(null===t.arrivalDate)return"-";let e=new Date(t.arrivalDate.replace("Z",""));return`${e.getDate()} ${C(e.getMonth())} ${e.getFullYear()}`})()}),(0,c.jsx)(i.Ly,{children:t.checkInTime>0?j(t.checkInTime):"3:00 pm"})]}),(0,c.jsx)(i.jM,{}),(0,c.jsxs)("div",{style:{gridColumn:"2/3",display:"flex",flexDirection:"column",paddingLeft:"32px"},children:[(0,c.jsx)(i.G_,{children:"Depart"}),(0,c.jsx)(i.yt,{children:(()=>{if(null===t.departureDate)return"-";let e=new Date(t.departureDate.replace("Z",""));return`${e.getDate()} ${C(e.getMonth())} ${e.getFullYear()}`})()}),(0,c.jsx)(i.Ly,{children:t.checkOutTime>0?j(t.checkOutTime):"11:00 am"})]})]}),"Enquiry"!==w()&&(0,c.jsxs)(i.nM,{children:[(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Dates"}),(0,c.jsxs)(i.yt,{children:[(()=>{let e=new Date(t.arrivalDate.replace("Z",""));return`${e.getDate()} ${C(e.getMonth())}`})()," - ",(()=>{let e=new Date(t.departureDate.replace("Z",""));return`${e.getDate()} ${C(e.getMonth())}`})()]})]}),b()]}),"Enquiry"!==w()&&(0,c.jsxs)(i.nM,{children:[(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Guests"}),(0,c.jsx)(i.yt,{children:t.guests})]}),b()]}),"Enquiry"!==w()&&t.completed&&(0,c.jsxs)(i.nM,{style:{border:"none"},children:[(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Booking ref."}),(0,c.jsx)(i.yt,{children:t.confirmationCode})]}),(0,c.jsx)(i.Ip,{type:"button",onClick:()=>{v(!0),navigator.clipboard.writeText(t?t.confirmationCode:"")},children:g?"Copied!":"Copy"})]}),"Enquiry"!==w()&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.Z1,{}),(0,c.jsx)(i.nM,{style:{border:"none"},children:(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[(0,c.jsx)(i.G_,{style:{fontSize:"22px",lineHeight:"26px",marginTop:"8px",marginBottom:"24px"},children:"Price details"}),r.priceItems.filter((e=>"Deposit"!==e.label)).map((e=>(0,c.jsxs)(i.sX,{children:[(0,c.jsx)(i.hY,{children:e.label}),(0,c.jsx)(i.hY,{children:e.amountFormatted})]},e.label))),r.subTotalItems.map(((e,t)=>(0,c.jsxs)(i.sX,{children:[(0,c.jsx)(i.hY,{style:{fontWeight:0===t?"600":"400"},children:e.label}),(0,c.jsx)(i.hY,{style:{fontWeight:0===t?"600":"400"},children:e.amountFormatted})]},e.label)))]})}),(0,c.jsx)(i.Z1,{})]}),(0,c.jsx)(i.G_,{style:{fontSize:"22px",lineHeight:"26px",marginTop:"32px",marginBottom:"24px"},children:"Guest policy"}),(0,c.jsxs)(i.T,{children:[(()=>{if(t){let e=new Date(t.arrivalDate),n=e.setUTCDate(e.getUTCDate()-1),o=e.setUTCDate(e.getUTCDate()-14),i=e.setUTCDate(e.getUTCDate()-28);if("flexible"===t.cancellationPolicy)return(0,c.jsxs)("div",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(n).getUTCDate()} ${C(new Date(n).getMonth())}`,"."]})," After that, you will receive a full refund of unspent nights minus service fee and cleaning fee if applicable."]});if("moderate"===t.cancellationPolicy)return(0,c.jsxs)("div",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(o).getUTCDate()} ${C(new Date(o).getMonth())}`,"."]})," After that, you will receive a full refund of unspent nights minus service fee and cleaning fee if applicable."]});if("strict"===t.cancellationPolicy)return(0,c.jsxs)("div",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(i).getUTCDate()} ${C(new Date(i).getMonth())}`,"."]})," After that, if your guest cancel less than 2 weeks to arrival, they will be charged for the first week."]})}})(),t.deposit>0?(0,c.jsxs)("div",{style:{marginTop:"24px"},children:[(0,c.jsxs)("strong",{children:["Your host may charge a $",Number(t.deposit/100)," AUD deposit. "]})," This is usually processed at check-in, your host will provide more information."]}):(0,c.jsxs)("div",{style:{marginTop:"24px"},children:[(0,c.jsx)("strong",{children:"No deposit. "})," You don't have to pay a deposit. However, you may still be liable for damages. Your host will provide more information."]})]}),(0,c.jsxs)(i.T,{children:[(0,c.jsx)("strong",{children:"Always communicate through Anystay."})," To protect your payment, never transfer money or communicate outside of the Anystay website or app."]}),(0,c.jsx)(i.FQ,{onClick:()=>window.Intercom("showNewMessage",""),children:"Report host"})]}):(0,c.jsx)(i.ft,{})}function k(e){let{loading:t,message:n,listingOwnerProfilePictureURL:s,prevMessage:a}=e;const[d,u]=(0,o.useState)(!1),[g,h]=(0,r.useRecoilState)(l.e),v=(null===a||void 0===a?void 0:a.author)===n.author;return(0,o.useEffect)((()=>{let e=null;return t?e=setTimeout((()=>{u(!0)}),2e3):u(!1),()=>{e&&clearTimeout(e)}}),[t]),n.author!==g.id?(0,c.jsxs)("div",{style:v?{display:"flex",alignItems:"flex-start",gap:"8px",width:"70%"}:{display:"flex",alignItems:"flex-start",gap:"8px",width:"70%",marginTop:"20px"},children:[(0,c.jsx)(i.Jb,{src:s}),(0,c.jsx)(i.WG,{children:n.body})]}):(0,c.jsx)("div",{style:{display:"flex",width:"70%",marginLeft:"auto"},children:(0,c.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"16px"},children:[(0,c.jsx)(p.A,{style:{visibility:d?"visible":"hidden"}}),(0,c.jsx)(i.bM,{isSameAuthor:v,children:n.body})]})})}function T(e){let{conversationmodelID:t,accessToken:n,addMessage:s,scrollToBottomConversation:a}=e;const[d,u]=(0,o.useState)(""),[g,h]=(0,r.useRecoilState)(l.e),[v,x]=(0,o.useState)(0),p=async()=>{if(u(""),x((e=>e+1)),d.trim().length>0)if(v<5){const e=(e=>{for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(62*Math.random()));return t})(10);await s({author:g.id,body:d.trim(),conversationmodelID:t,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isNote:null,guestNoteBody:null,hostNoteBody:null,id:null,loading:!0,tempId:e}),a(),await(0,C.p)("put","dev-anystay-booking","conversation/guest/message",{headers:{Authorization:n,conversationID:t},body:{author:g.id,body:d.trim(),conversationModelId:t,tempId:e}}).then((e=>{x((e=>e-1))})).catch((e=>{console.log(e)}))}else alert("Sending too quickly!")};return(0,c.jsxs)(i.cQ,{children:[(0,c.jsx)(i.qR,{type:"text",placeholder:"Type your message",value:d,onChange:e=>u(e.target.value),onKeyPress:e=>"Enter"===e.key?p():null}),(0,c.jsx)(i.kL,{type:"button",onClick:()=>p(),children:(0,c.jsx)(i.CD,{src:"https://d292awxalydr86.cloudfront.net/Inbox/Send.svg",alt:"Send button"})})]})}function A(e){let{accessToken:t,conversation:n,addMessage:o,scrollToBottomConversation:l,bookingRequest:r}=e;const s=new Date,a=new Date(null===r||void 0===r?void 0:r.arrivalDate);return(0,c.jsxs)(i.M2,{children:[(0,c.jsx)(T,{accessToken:t,conversationmodelID:n.id,addMessage:o,scrollToBottomConversation:l}),r&&(r.completed?(0,c.jsx)(i._m,{children:(0,c.jsx)(i.Hb,{to:`/your-booking/${r.id}`,children:"Details"})}):s>a?(0,c.jsx)(i._m,{}):(0,c.jsx)(i._m,{children:(0,c.jsx)(i.E4,{to:`/complete-booking/${r.id}`,children:"Complete booking"})}))]})}const S=w.Ay.div`
    grid-row: 3/4;
    grid-column: 1/2;
    width: 100%;
    max-height: calc(100% - 162px);
    overflow-y: scroll !important;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    // padding-bottom: 132px;
    @media (min-width: 768px) {
        grid-column: 2/3;
        max-height: calc(100% - 110px);
    }
`;function R(){return(0,c.jsx)(S,{children:(0,c.jsx)(p.A,{style:{width:"50px",height:"50px"}})})}function $(e){let{accessToken:t,listingOwnerProfilePictureURL:n}=e;const[a,d]=(0,o.useState)(!0),[u,g]=(0,o.useState)([]),h=(0,o.useRef)(null),v=(0,o.useRef)(null),x=(0,o.useRef)(0),j=(0,o.useRef)(!1),[w,b]=(0,o.useState)(!1),[D,M]=(0,o.useState)(null),[T,S]=(0,o.useState)(null),[$,q]=(0,o.useState)(null),{id:B}=(0,s.g)(),I=(0,o.useRef)(null),[L,U]=(0,r.useRecoilState)(l.e),P=()=>{var e,t;null===(e=h.current)||void 0===e||e.scrollTo({top:null===(t=h.current)||void 0===t?void 0:t.scrollHeight})},O=(0,o.useCallback)((()=>{if((()=>{var e,t;return(null===(e=h.current)||void 0===e?void 0:e.scrollHeight)>(null===(t=h.current)||void 0===t?void 0:t.clientHeight)})()&&!j.current){var e,t,n;if(null===v.current)return;if(null!==(e=h.current)&&void 0!==e&&e.scrollHeight)x.current=null===(n=h.current)||void 0===n?void 0:n.scrollHeight;b(0===(null===(t=h.current)||void 0===t?void 0:t.scrollTop))}}),[]),H=(0,o.useCallback)(((e,t)=>{let n=[...t],o=[];for(let i=0;i<e.length;i++){let l=!0;for(let o=0;o<t.length;o++)e[i].tempId===t[o].tempId&&t[o].loading&&(n[o]=e[i]),e[i].id!==t[o].id&&e[i].tempId!==t[o].tempId||(l=!1);l&&o.push(e[i])}return n.concat(o)}),[]),E=(0,o.useCallback)((async e=>{j.current=!0,await(0,C.p)("post","dev-anystay-booking","conversation",{headers:{Authorization:t,conversationID:D.id},body:{conversationId:D.id,nextToken:e}}).then((e=>{console.log(e),e.success&&(v.current=e.body.nextToken,b(!1),g((t=>[...e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())),t])),(()=>{var e,t;null===(e=h.current)||void 0===e||e.scrollTo({top:(null===(t=h.current)||void 0===t?void 0:t.scrollHeight)-x.current})})(),j.current=!1)})).catch((e=>console.log(e)))}),[D,t]),N=(0,o.useCallback)((async function(){var e,n,o,i,l,r;let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=Math.floor(null===(e=h.current)||void 0===e?void 0:e.scrollTop)+(null===(n=h.current)||void 0===n?void 0:n.clientHeight)>=(null===(o=h.current)||void 0===o?void 0:o.scrollHeight)-50||!(null!==(i=h.current)&&void 0!==i&&i.scrollTop)&&!(null!==(l=h.current)&&void 0!==l&&l.scrollHeight)&&!(null!==(r=h.current)&&void 0!==r&&r.clientHeight);"null"!==B&&B&&await(0,C.p)("get","dev-anystay-booking",`conversation/${B}`,{headers:{Authorization:t,conversationId:B}}).then((async e=>{console.log("message",e),v.current=e.body.nextToken,S(e.body.conversation.BookingRequestModel),q(e.body.conversation.UserHostModel.UserModel),M(e.body.conversation),g((t=>{const n=s?e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())):H(e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())),t);return n.length>0&&n[n.length-1].author!==L.id&&a&&P(),n}))}))}),[B,t,H,L]),G=(0,o.useCallback)((()=>{m.n.graphql((0,y.D)(f.Xy,{conversationmodelID:B})).subscribe({next:async e=>{let{provider:t,value:n}=e;await N()},error:e=>console.log(e)})}),[N,B]);return(0,o.useEffect)((()=>{(async()=>{d(!0),L&&(G(),await N(B!==I.current)),B&&(I.current=B),d(!1)})()}),[N,G,L,B]),(0,o.useEffect)((()=>{if(!a){const{current:e}=h;return P(),null===e||void 0===e||e.addEventListener("scroll",O),()=>{null===e||void 0===e||e.removeEventListener("scroll",O)}}}),[O,a]),(0,o.useEffect)((()=>{w&&v.current&&E(v.current)}),[E,w]),a?(0,c.jsx)(R,{}):0===u.length?(0,c.jsxs)(i.hA,{children:[(0,c.jsx)(i.xU,{children:"No messages yet"}),(0,c.jsx)(i.ps,{children:"All of your messages will appear here"})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(i.hA,{ref:h,children:[w&&(0,c.jsx)(i.pM,{children:(0,c.jsx)(p.A,{})}),D&&(0,c.jsx)(i.Gl,{style:{marginTop:"0px"},children:`${new Date(D.updatedAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(D.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),D&&$&&u.map(((e,t)=>{const o=t>0?u[t-1]:void 0;if(0===t)return e.isNote?(0,c.jsx)(i.kl,{children:e.guestNoteBody},t):e.body?(0,c.jsx)(k,{listingOwnerProfilePictureURL:n,message:e,prevMessage:o},t):null;const l=new Date(e.createdAt),r=new Date(u[t-1].createdAt),s=(l.getTime()-r.getTime())/36e5;return e.isNote?s>=1?l.getDate()!==r.getDate()?(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(i.kl,{children:e.guestNoteBody})]},t):(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(i.kl,{children:e.guestNoteBody})]},t):(0,c.jsx)(i.kl,{children:e.guestNoteBody},t):e.body?s>=1?l.getDate()!==r.getDate()?(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(k,{loading:e.loading,listingOwnerProfilePictureURL:n,message:e,prevMessage:o})]},t):(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(k,{loading:e.loading,listingOwnerProfilePictureURL:n,message:e,prevMessage:o})]},t):(0,c.jsx)(k,{loading:e.loading,listingOwnerProfilePictureURL:n,message:e,prevMessage:o},t):null}))]}),(0,c.jsx)(A,{accessToken:t,conversation:D,addMessage:async e=>{g([...u,e])},scrollToBottomConversation:P,bookingRequest:T})]})}var q=n(9082),B=n(8306),I=n(8069);function L(){const{id:e}=(0,s.g)(),[t,n]=(0,r.useRecoilState)(l.e),[a,d]=(0,r.useRecoilState)(q.H),h=(0,s.Zp)(),[x,p]=(0,o.useState)(!0),[m,y]=(0,o.useState)(null),[f,w]=(0,o.useState)(null),[b,D]=(0,o.useState)(null),[k,T]=(0,o.useState)(null),[A,S]=(0,o.useState)("https://d292awxalydr86.cloudfront.net/Settings+page/Profile+photo+placeholder.png"),[R,L]=(0,o.useState)(null),U=(0,o.useCallback)((async()=>{"null"!==e&&e&&await(0,C.p)("get","dev-anystay-booking",`conversation/${e}`,{headers:{Authorization:a,conversationId:e}}).then((async e=>{var t,n,o,i,l,r,s,a,d,c,u,g,h,v,x;if(console.log(e),e.body.conversation.UserHostModel.UserModel.profilePicture){const t=(0,I.A)(e.body.conversation.UserHostModel.UserModel.profilePicture,e.body.conversation.UserHostModel.UserModel.identityID,100);S(t)}(y(null===(t=e.body)||void 0===t?void 0:t.conversation),w(null===(n=e.body)||void 0===n||null===(o=n.conversation)||void 0===o?void 0:o.BookingRequestModel),D(null===(i=e.body)||void 0===i||null===(l=i.conversation)||void 0===l||null===(r=l.BookingRequestModel)||void 0===r?void 0:r.ListingModel),T(null===(s=e.body)||void 0===s||null===(a=s.conversation)||void 0===a||null===(d=a.UserHostModel)||void 0===d?void 0:d.UserModel),null!==(c=e.body)&&void 0!==c&&null!==(u=c.conversation)&&void 0!==u&&null!==(g=u.BookingRequestModel)&&void 0!==g&&g.guestPriceBreakdown)&&L(JSON.parse(null===(h=e.body)||void 0===h||null===(v=h.conversation)||void 0===v||null===(x=v.BookingRequestModel)||void 0===x?void 0:x.guestPriceBreakdown))}))}),[e,a]);return(0,o.useEffect)((()=>{t?(async()=>{p(!0),await U(),p(!1)})():h("/")}),[U,h,t]),(0,c.jsxs)(i.f9,{children:[(0,c.jsx)(B.A,{title:"Inbox | Anystay"}),window.innerWidth<768&&(0,c.jsx)(u,{listingOwnerData:k,bookingRequest:f}),(0,c.jsx)(g,{listingOwnerData:k,bookingRequest:f}),window.innerWidth<768&&(0,c.jsx)(v,{bookingRequest:f,conversation:m,listingData:b}),(0,c.jsx)(j,{accessToken:a}),(0,c.jsx)($,{accessToken:a,listingOwnerProfilePictureURL:A}),(0,c.jsx)(M,{loadingPage:x,bookingRequest:f,listingOwnerData:k,listingData:b,guestPriceBreakdown:R})]})}}}]);
//# sourceMappingURL=8629.fb8f2375.chunk.js.map
//# debugId=2787eb79-a448-5021-bfc3-748ef2de1c9a
