"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="d55f9ac2-de7f-5f98-aadf-2a8e8d5b557b")}catch(e){}}();
(self.webpackChunkanystay_dev=self.webpackChunkanystay_dev||[]).push([[8017],{8017:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var o=n(5043),s=n(3216),r=n(7426),i=n(7986),l=n(7607),a=n(831),d=n(1852),c=n(579);function u(e){let{bookingGuestData:t}=e;const n=(0,s.Zp)(),[o,r]=(0,a.useRecoilState)(l.o);return t?(0,c.jsxs)(i.tL,{children:[(0,c.jsx)(d.A,{onClick:()=>{n(`/your-host-inbox/${o.id}`)},type:"Arrow"}),(0,c.jsx)(i.yC,{children:t.firstName}),(0,c.jsx)(i.Hq,{href:`tel:${t.phone}`,children:(0,c.jsx)(i.JB,{src:"https://d292awxalydr86.cloudfront.net/Universal+icons/Call.svg",alt:"Call"})})]}):null}function h(e){let{bookingGuestData:t}=e;return t?(0,c.jsxs)(i.Ov,{children:[(0,c.jsx)("div",{children:(0,c.jsx)(i.Hm,{children:t.firstName})}),(0,c.jsx)(i.NG,{href:`tel:${t.phone}`,children:(0,c.jsx)(i.JB,{src:"https://d292awxalydr86.cloudfront.net/Universal+icons/Call.svg",alt:"Call"})})]}):null}var g=n(9138),x=n(8069);function p(e){var t;let{conversation:n}=e;const{id:r}=(0,s.g)(),[l,a]=(0,o.useState)("https://d292awxalydr86.cloudfront.net/Settings+page/Profile+photo+placeholder.png");(0,o.useEffect)((()=>{var e;if(null!==n&&void 0!==n&&null!==(e=n.UserModel)&&void 0!==e&&e.profilePicture){const e=(0,x.A)(n.UserModel.profilePicture,n.UserModel.identityID,100);a(e)}}),[n]);return(0,c.jsxs)(i.p1,{to:`/host-conversation/${n.id}`,selected:n.id===r,children:[(0,c.jsx)(i.Nw,{src:l,alt:"Photo fo listing owner"}),(0,c.jsxs)(i.zW,{children:[(0,c.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"},children:[(0,c.jsx)(i.Mq,{children:null===(t=n.UserModel)||void 0===t?void 0:t.firstName}),n.BookingRequestModel&&(0,c.jsx)(i.ff,{children:(()=>{let e=new Date(n.updatedAt),t=((new Date).getTime()-e.getTime())/1e3/60/60;return t>24?`${Math.floor(t/24)}d`:t<1?`${Math.floor(60*t)}m`:`${Math.floor(t)}h`})()})]}),(0,c.jsx)(i.Mq,{children:0===n.MessageModels.items.length?null:null!==n.MessageModels.items[0].body?n.MessageModels.items[0].body:null!==n.MessageModels.items[0].hostNoteBody?n.MessageModels.items[0].hostNoteBody:void 0}),(0,c.jsx)(i.ff,{children:(()=>{if(n.BookingRequestModel.ListingModel){const e=`${n.BookingRequestModel.declined?"Declined":n.BookingRequestModel.cancelled?"Cancelled":n.BookingRequestModel.completed?n.BookingRequestModel.confirmed?"Confirmed":n.BookingRequestModel.expired?"Expired":"Requested":"Enquiry"} \u2022 ${n.BookingRequestModel.ListingModel.propertyTitle}`;return e.length>43?e.substring(0,40).trim()+"...":e}return""})()})]})]})}var y=n(8297),m=n(6546),f=n(2945),v=n(2119);const j=v.Ay.div`
    grid-column: 1/2;
    grid-row: 1/4;
    width: 100%;
    max-height: calc(100% - 162px);
    overflow-y: scroll !important;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    @media (max-width: 767px) {
        display: none;
    }
`;function b(){return(0,c.jsx)(j,{children:(0,c.jsx)(g.A,{style:{width:"50px",height:"50px"}})})}function w(e){let{accessToken:t}=e;const n=(0,o.useRef)(null),s=(0,o.useRef)(null),d=(0,o.useRef)(!1),[u,h]=(0,o.useState)(!1),[x,v]=(0,o.useState)([]),[j,w]=(0,a.useRecoilState)(l.o),[D,k]=(0,o.useState)(!1),M=(0,o.useCallback)((()=>{if((()=>{var e,t;return(null===(e=n.current)||void 0===e?void 0:e.scrollHeight)>(null===(t=n.current)||void 0===t?void 0:t.clientHeight)})()&&!d.current){var e,t,o;if(null===s.current)return;h(Math.ceil(null===(e=n.current)||void 0===e?void 0:e.scrollTop)+(null===(t=n.current)||void 0===t?void 0:t.clientHeight)>=(null===(o=n.current)||void 0===o?void 0:o.scrollHeight))}}),[]),T=(0,o.useCallback)((async e=>{y.n.graphql((0,m.D)(f.Yw,{userhostmodelID:e})).subscribe({next:e=>{let{provider:t,value:n}=e;v((e=>{const t=n.data.onUpdateConversationByUserHostModelID,o=e.map((e=>e.id===t.id?{...e,MessageModels:t.MessageModels,updatedAt:(new Date).toISOString(),status:t.status}:e));return A(o)}))},error:e=>console.warn(e)})}),[]),A=e=>[...e.sort(((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()))],C=(0,o.useCallback)((async()=>{await(0,r.p)("post","dev-anystay-user","user/host/conversations",{headers:{Authorization:t},body:{userHostModelId:j.id,nextToken:null}}).then((e=>{console.log(e),e.success&&(s.current=e.body.nextToken,v(e.body.conversations))}))}),[t,j]),$=(0,o.useCallback)((async e=>{d.current=!0,await(0,r.p)("post","dev-anystay-user","user/host/conversations",{headers:{Authorization:t},body:{userHostModelId:j.id,nextToken:e}}).then((e=>{console.log(e),e.success&&(s.current=e.body.nextToken,h(!1),v((t=>[...t,...e.body.conversations])),d.current=!1)})).catch((e=>console.log(e)))}),[t,j]);return(0,o.useEffect)((()=>{if(!D){const{current:e}=n;return null===e||void 0===e||e.addEventListener("scroll",M),()=>{null===e||void 0===e||e.removeEventListener("scroll",M)}}}),[M,D]),(0,o.useEffect)((()=>{u&&s.current&&(console.log("fetch more conversation"),$(s.current))}),[$,u]),(0,o.useEffect)((()=>{(async()=>{k(!0),await C(),await T(j.id),k(!1)})()}),[C,T,j]),D?(0,c.jsx)(b,{}):(0,c.jsxs)(i.FO,{ref:n,children:[(0,c.jsx)(i.g5,{children:"Inbox"}),(0,c.jsxs)(i.pb,{children:[x.map((e=>(0,c.jsx)(p,{conversation:e},e.id))),u&&(0,c.jsx)(i.Yy,{children:(0,c.jsx)(g.A,{})})]})]})}var D=n(4936),k=n(6879);function M(e){let{bookingRequest:t,listingData:n}=e;const o=(0,s.Zp)(),r=e=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]?t[e]:""};return t&&n?(0,c.jsxs)(i.qj,{type:"button",onClick:()=>{t.completed?o(`/your-booking/${t.id}`):o(`/listing/${t.listingmodelID}`)},children:[(0,c.jsx)(i._o,{src:(0,k.A)(JSON.parse(n.listingImages[0]).key,500),alt:"Picture of listing model"}),(0,c.jsxs)(i.XM,{children:[(0,c.jsx)(i.FV,{children:`${n.propertyTitle.substr(0,15)}${n.propertyTitle.split("").length>15?"...":""}`}),(0,c.jsxs)(i.rc,{style:{color:t.declined||t.cancelled||t.confirmed||!t.completed?D.J2.Black.color:D.J2.Yellow.color},children:[(()=>{if(t)return t.declined?"Declined":t.cancelled?"Cancelled":t.completed?t.confirmed?"Confirmed":t.expired?"Expired":"Requested":"Enquiry"})()," \u2022 ",(()=>{if(null===t.arrivalDate)return"-";let e=new Date(t.arrivalDate.replace("Z",""));return`${e.getDate()} ${r(e.getMonth())}`})()," - ",(()=>{if(null===t.departureDate)return"-";let e=new Date(t.departureDate.replace("Z",""));return`${e.getDate()} ${r(e.getMonth())}`})()," "]})]})]}):null}const T=v.Ay.div`
    grid-row: 1/4;
    grid-column: 3/4;
    height: 100%;
    width: 100%;
    border-left: 1px solid ${D.J2.Grey2.color};
    padding: 44px 32px;
    padding-top: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    @media (max-width: 1280px) {
        display: none;
    }
`;function A(){return(0,c.jsx)(T,{children:(0,c.jsx)(g.A,{style:{width:"50px",height:"50px"}})})}var C=n(9856),$=n(1743),S=n(3546);function R(e){let{bookingRequest:t,bookingGuestData:n,guestProfilePictureURL:s,listingData:r,loadingPage:l,hostPriceBreakdown:a}=e;const d=(0,o.useRef)(null),[u,h]=(0,o.useState)(!1),g=()=>{if(t)return t.declined?"Declined":t.cancelled?"Cancelled":t.completed?t.confirmed?"Confirmed":"Requested":"Enquiry"},x=e=>{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t[e]?t[e]:""},p=e=>{if(e<100||e>2400)return null;return`${1200===e||2400===e?12:e/100%12}:00${e>1100&&e<2400?"pm":"am"}`},[y,m]=(0,o.useState)(!1),f=()=>{y?(window.Intercom("hide"),m(!1)):(window.Intercom("showNewMessage",""),m(!0))},v=(0,C.A)(y,f);return l?(0,c.jsx)(A,{}):t&&n&&r?(0,c.jsxs)(i.ft,{ref:d,children:["Enquiry"!==g()&&(t.cancelled||t.declined?null:t.confirmed?(0,c.jsx)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"32px"},children:(0,c.jsx)(i.Hb,{style:{background:D.J2.Black.color},to:`/booking-request/${t.id}`,children:"Details"})}):(0,c.jsx)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"32px"},children:(0,c.jsx)(i.E4,{style:{background:D.J2.Yellow.color},to:`/booking-request/${t.id}`,children:"Respond"})})),(0,c.jsxs)(i.m4,{children:[(0,c.jsx)(i.mU,{children:(0,c.jsx)(i.pI,{src:s,alt:""})}),(0,c.jsxs)(i.D9,{children:[(0,c.jsx)(i.wt,{children:g()}),(0,c.jsx)(i.mX,{children:n.firstName}),(0,c.jsx)(i.gT,{children:`$${(t.bookingAmount/100).toFixed(2)} ${t.refundedAmount>0?`(-$${(t.refundedAmount/100).toFixed(2)})`:""} AUD`}),r&&(0,c.jsx)(i.Y6,{children:r.propertyTitle}),t&&(0,c.jsxs)(i.Y6,{style:{textDecoration:"none"},children:[(()=>{let e=(new Date(new Date(t.departureDate).setUTCHours(0,0,0,0)).getTime()-new Date(new Date(t.arrivalDate).setUTCHours(0,0,0,0)).getTime())/864e5;return Math.ceil(e)})()," nights \u2022 ",t.guests," guest",t.guests>1&&"s"]})]})]}),(0,c.jsxs)(i.VS,{children:[(0,c.jsxs)("div",{style:{gridColumn:"1/2",gridRow:"1/2",display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Arrive"}),(0,c.jsx)(i.yt,{children:(()=>{if(null===t.arrivalDate)return"-";let e=new Date(t.arrivalDate.replace("Z",""));return`${e.getDate()} ${x(e.getMonth())} ${e.getFullYear()}`})()}),(0,c.jsx)(i.Ly,{children:t.checkInTime>0?p(t.checkInTime):"3:00PM"})]}),(0,c.jsx)(i.jM,{}),(0,c.jsxs)("div",{style:{gridColumn:"2/3",display:"flex",flexDirection:"column",paddingLeft:"32px"},children:[(0,c.jsx)(i.G_,{children:"Depart"}),(0,c.jsx)(i.yt,{children:(()=>{if(null===t.departureDate)return"-";let e=new Date(t.departureDate.replace("Z",""));return`${e.getDate()} ${x(e.getMonth())} ${e.getFullYear()}`})()}),(0,c.jsx)(i.Ly,{children:t.checkOutTime?p(t.checkOutTime):"10:00AM"})]})]}),(0,c.jsxs)(i.f7,{children:[(0,c.jsx)(i.mH,{children:"Guests"}),(0,c.jsxs)(i.mH,{children:[t.guests," guest",t.guests>1&&"s",t.infants>1?`, ${t.infants} infants`:t.infants>0&&`, ${t.infants} infant`,t.pets>1?`, ${t.pets} pes`:t.pets>0&&`, ${t.pets} pet`]})]}),"Enquiry"!==g()&&(0,c.jsxs)(i.f7,{children:[(0,c.jsx)(i.mH,{children:"Booking date"}),(0,c.jsx)(i.mH,{children:new Date(t.createdAt.replace("Z","")).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})})]}),"Enquiry"!==g()&&(0,c.jsxs)(i.f7,{children:[(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,c.jsx)(i.G_,{children:"Booking ref."}),(0,c.jsx)(i.yt,{children:t.confirmationCode})]}),(0,c.jsxs)(i.v,{type:"button",onClick:()=>{h(!0),navigator.clipboard.writeText(t.confirmationCode),setTimeout((()=>{h(!1)}),2e3)},children:[u?"Copied!":"Copy",(0,c.jsx)(S.N,{children:u&&(0,c.jsx)($.A,{})})]})]}),(0,c.jsx)(i.f7,{style:{border:"none"},children:(0,c.jsx)(i.yk,{to:"/your-calendar",children:"See calendar"})}),"Enquiry"!==g()&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.Z1,{}),(0,c.jsx)(i.nM,{style:{paddingTop:"0"},children:(0,c.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%"},children:[(0,c.jsx)(i.Du,{style:{marginBottom:"24px"},children:"Your payout"}),a.priceItems.map(((e,t)=>(0,c.jsxs)(i.sX,{children:[(0,c.jsx)(i.hY,{children:e.label}),(0,c.jsx)(i.hY,{children:e.amountFormatted})]},e.label))),a.subTotalItems.map(((e,t)=>(0,c.jsxs)(i.sX,{children:[(0,c.jsx)(i.hY,{style:{fontWeight:0===t?"600":"400"},children:e.label}),(0,c.jsx)(i.hY,{style:{fontWeight:0===t?"600":"400"},children:e.amountFormatted})]},e.label)))]})})]}),t.confirmed&&(0,c.jsx)(i.f7,{style:{border:"none"},children:(0,c.jsx)(i.yk,{to:`/payment-details/${t.id}`,children:"Manage payout"})}),(0,c.jsx)(i.Z1,{}),(0,c.jsx)(i.Du,{children:"Guest policy"}),(0,c.jsxs)(i.T,{children:[(()=>{let e=new Date(t.arrivalDate),n=e.setUTCDate(e.getUTCDate()-1),o=e.setUTCDate(e.getUTCDate()-14),s=e.setUTCDate(e.getUTCDate()-28);return"flexible"===t.cancellationPolicy?(0,c.jsxs)("span",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(n).getUTCDate()} ${x(new Date(n).getMonth())}`,"."]})," After that, if your guest cancels they will receive a full refund of unspent nights minus service fee and cleaning fee if applicable."]}):"moderate"===t.cancellationPolicy?(0,c.jsxs)("span",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(o).getUTCDate()} ${x(new Date(o).getMonth())}`,"."]})," After that, if your guest cancels they will receive a full refund of half the unspent nights minus service fee and cleaning fee if applicable."]}):"strict"===t.cancellationPolicy?(0,c.jsxs)("span",{children:[(0,c.jsxs)("strong",{children:["Free cancellation before ",`${new Date(s).getUTCDate()} ${x(new Date(s).getMonth())}`,"."]})," After that, if your guest cancel less than 2 weeks to arrival, they will be charged for the first week."]}):void 0})(),(0,c.jsx)("br",{}),(0,c.jsx)("br",{}),t.deposit>0?(0,c.jsxs)("span",{children:[(0,c.jsxs)("strong",{children:["Your host may charge a $",Number(t.deposit/100)," AUD deposit. "]})," This is usually processed at check-in, your host will provide more information."]}):(0,c.jsxs)("span",{children:[(0,c.jsx)("strong",{children:"No deposit. "})," You don't have to pay a deposit. However, you may still be liable for damages. Your host will provide more information."]})]}),(0,c.jsxs)(i.T,{children:[(0,c.jsx)("strong",{children:"Always communicate through Anystay."})," To protect your payment, never transfer money or communicate outside of the Anystay website or app."]}),(0,c.jsx)(i.FQ,{onClick:f,style:{color:D.J2.Black.color},ref:v,children:"Report guest"})]}):(0,c.jsx)(i.ft,{})}const q=v.Ay.div`
    grid-row: 3/4;
    grid-column: 1/2;
    width: 100%;
    max-height: calc(100% - 162px);
    overflow-y: scroll !important;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    // padding-bottom: 132px;
    @media (min-width: 768px) {
        grid-column: 2/3;
        max-height: calc(100% - 110px);
    }
`;function B(){return(0,c.jsx)(q,{children:(0,c.jsx)(g.A,{style:{width:"50px",height:"50px"}})})}function I(e){let{loading:t,message:n,url:s,prevMessage:r}=e;const[d,u]=(0,o.useState)(!1),[h,x]=(0,a.useRecoilState)(l.o),p=(null===r||void 0===r?void 0:r.author)===n.author;return(0,o.useEffect)((()=>{let e=null;return t?e=setTimeout((()=>{u(!0)}),2e3):u(!1),()=>{console.log("clearing timeout"),e&&clearTimeout(e)}}),[t]),n.author!==h.id?(0,c.jsxs)("div",{style:p?{display:"flex",alignItems:"flex-start",gap:"8px",width:"70%"}:{display:"flex",alignItems:"flex-start",gap:"8px",width:"70%",marginTop:"20px"},children:[(0,c.jsx)(i.Jb,{src:s}),(0,c.jsx)(i.WG,{children:n.body})]}):(0,c.jsx)("div",{style:{display:"flex",width:"70%",marginLeft:"auto"},children:(0,c.jsxs)("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"16px"},children:[(0,c.jsx)(g.A,{style:{visibility:d?"visible":"hidden"}}),(0,c.jsx)(i.bM,{isSameAuthor:p,children:n.body})]})})}const U=e=>{const[t,n]=(0,o.useState)(""),[s,l]=(0,o.useState)(0),a=async()=>{if(n(""),l((e=>e+1)),t.trim().length>0)if(s<5){const n=(e=>{for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(62*Math.random()));return t})(10);await e.addMessage({author:e.userHostModel.id,body:t.trim(),conversationmodelID:e.conversationmodelID,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),isNote:null,guestNoteBody:null,hostNoteBody:null,id:null,loading:!0,tempId:n}),e.scrollToBottomConversation(),await(0,r.p)("put","dev-anystay-booking","conversation/host/message",{headers:{Authorization:e.accessToken,conversationId:e.conversationmodelID},body:{author:e.userHostModel.id,body:t.trim(),conversationmodelId:e.conversationmodelID,tempId:n}}).then((e=>{l((e=>e-1))})).catch((e=>{console.log(e)}))}else alert("Sending too quickly!")};return(0,c.jsxs)(i.cQ,{children:[(0,c.jsx)(i.qR,{type:"text",placeholder:"Type your message",value:t,onChange:e=>n(e.target.value),onKeyPress:e=>"Enter"===e.key&&a()}),(0,c.jsx)(i.kL,{type:"button",onClick:()=>a(),children:(0,c.jsx)(i.CD,{src:"https://d292awxalydr86.cloudfront.net/Inbox/Send.svg",alt:"Send button"})})]})};function H(e){let{accessToken:t,conversation:n,addMessage:o,scrollToBottomConversation:s,bookingRequest:r,userHostModel:l}=e;return(0,c.jsxs)(i.M2,{children:[(0,c.jsx)(U,{accessToken:t,conversationmodelID:n.id,addMessage:o,scrollToBottomConversation:s,userHostModel:l}),(()=>{if(r){if(0!==r.ChangeBookingRequestModel.items.length)return r.ChangeBookingRequestModel.items[0].confirmed?(0,c.jsx)(i._m,{children:(0,c.jsx)(i.Hb,{style:{background:D.J2.Blue.color},to:`/booking-request/${r.id}`,children:"Details"})}):(0,c.jsx)(i._m,{children:(0,c.jsx)(i.E4,{style:{background:D.J2.Yellow.color},to:`/booking-request/${r.id}`,children:"Review changes"})});if(r.cancelled||r.declined)return null;if(null===r.confirmed&&r.completed)return(0,c.jsx)(i._m,{children:(0,c.jsx)(i.Hb,{style:{background:D.J2.Yellow.color},to:`/booking-request/${r.id}`,children:"Response"})});if(r.confirmed&&r.completed||!r.completed)return(0,c.jsx)(i._m,{children:(0,c.jsx)(i.Hb,{style:{background:D.J2.Blue.color},to:`/booking-request/${r.id}`,children:"Details"})})}})()]})}function L(e){let{accessToken:t,guestProfilePictureURL:n}=e;const[d,u]=(0,o.useState)(!0),[h,x]=(0,o.useState)([]),p=(0,o.useRef)(null),v=(0,o.useRef)(null),j=(0,o.useRef)(0),b=(0,o.useRef)(!1),[w,D]=(0,o.useState)(!1),[k,M]=(0,o.useState)(null),[T,A]=(0,o.useState)(null),[C,$]=(0,o.useState)(null),{id:S}=(0,s.g)(),R=(0,o.useRef)(null),[q,U]=(0,a.useRecoilState)(l.o),L=()=>{var e,t;null===(e=p.current)||void 0===e||e.scrollTo({top:null===(t=p.current)||void 0===t?void 0:t.scrollHeight})},N=(0,o.useCallback)((()=>{if((()=>{var e,t;return(null===(e=p.current)||void 0===e?void 0:e.scrollHeight)>(null===(t=p.current)||void 0===t?void 0:t.clientHeight)})()&&!b.current){var e,t,n;if(null===v.current)return;if(null!==(e=p.current)&&void 0!==e&&e.scrollHeight)j.current=null===(n=p.current)||void 0===n?void 0:n.scrollHeight;D(0===(null===(t=p.current)||void 0===t?void 0:t.scrollTop))}}),[]),P=(0,o.useCallback)(((e,t)=>{let n=[...t],o=[];for(let s=0;s<e.length;s++){let r=!0;for(let o=0;o<t.length;o++)e[s].tempId===t[o].tempId&&t[o].loading&&(n[o]=e[s]),e[s].id!==t[o].id&&e[s].tempId!==t[o].tempId||(r=!1);r&&o.push(e[s])}return n.concat(o)}),[]),E=(0,o.useCallback)((async e=>{b.current=!0,await(0,r.p)("post","dev-anystay-booking","conversation",{headers:{Authorization:t,conversationID:k.id},body:{conversationId:k.id,nextToken:e}}).then((e=>{e.success&&(v.current=e.body.nextToken,D(!1),x((t=>[...e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())),t])),(()=>{var e,t;null===(e=p.current)||void 0===e||e.scrollTo({top:(null===(t=p.current)||void 0===t?void 0:t.scrollHeight)-j.current})})(),b.current=!1)})).catch((e=>console.log(e)))}),[k,t]),J=(0,o.useCallback)((async function(){var e,n,o,s,i,l;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=Math.floor(null===(e=p.current)||void 0===e?void 0:e.scrollTop)+(null===(n=p.current)||void 0===n?void 0:n.clientHeight)>=(null===(o=p.current)||void 0===o?void 0:o.scrollHeight)-50||!(null!==(s=p.current)&&void 0!==s&&s.scrollTop)&&!(null!==(i=p.current)&&void 0!==i&&i.scrollHeight)&&!(null!==(l=p.current)&&void 0!==l&&l.clientHeight);"null"!==S&&S&&await(0,r.p)("get","dev-anystay-booking",`conversation/${S}`,{headers:{Authorization:t,conversationId:S}}).then((async e=>{e&&(v.current=e.body.nextToken,A(e.body.conversation.BookingRequestModel),$(e.body.conversation.UserHostModel.UserModel),M(e.body.conversation),x((t=>{const n=a?e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())):P(e.body.conversation.MessageModels.items.sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())),t);return n.length>0&&n[n.length-1].author!==q.id&&d&&L(),n})))}))}),[S,t,q,P]),F=(0,o.useCallback)((()=>{y.n.graphql((0,m.D)(f.Xy,{conversationmodelID:S})).subscribe({next:async e=>{let{provider:t,value:n}=e;await J()},error:e=>console.log(e)})}),[J,S]);return(0,o.useEffect)((()=>{(async()=>{u(!0),q&&(F(),await J(S!==R.current)),S&&(R.current=S),u(!1)})()}),[J,F,S,q]),(0,o.useEffect)((()=>{if(!d){const{current:e}=p;return L(),null===e||void 0===e||e.addEventListener("scroll",N),()=>{null===e||void 0===e||e.removeEventListener("scroll",N)}}}),[N,d]),(0,o.useEffect)((()=>{w&&v.current&&E(v.current)}),[E,w]),d?(0,c.jsx)(B,{}):0===h.length?(0,c.jsxs)(i.hA,{children:[(0,c.jsx)(i.xU,{children:"No messages yet"}),(0,c.jsx)(i.ps,{children:"All of your messages will appear here"})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(i.hA,{ref:p,children:[w&&(0,c.jsx)(i.pM,{children:(0,c.jsx)(g.A,{})}),k&&(0,c.jsx)(i.Gl,{style:{marginTop:"0px"},children:`${new Date(k.createdAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(k.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),k&&C&&h.map(((e,t)=>{const s=t>0?h[t-1]:void 0;if(0===t)return e.isNote?(0,c.jsx)(i.kl,{children:e.hostNoteBody},t):e.body?(0,c.jsx)(I,{url:n,message:e,prevMessage:s},t):null;const r=new Date(e.createdAt),l=new Date(h[t-1].createdAt),a=(r.getTime()-l.getTime())/36e5;return e.isNote?a>=1?r.getDate()!==l.getDate()?(0,c.jsxs)(o.Fragment,{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(i.kl,{children:e.hostNoteBody})]},t):(0,c.jsxs)(o.Fragment,{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(i.kl,{children:e.hostNoteBody})]},t):(0,c.jsx)(i.kl,{children:e.hostNoteBody},t):e.body?a>=1?r.getDate()!==l.getDate()?(0,c.jsxs)(o.Fragment,{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleDateString("au",{day:"numeric",month:"short",year:"numeric"})}, ${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(I,{loading:e.loading,url:n,message:e,prevMessage:s})]},t):(0,c.jsxs)(o.Fragment,{children:[(0,c.jsx)(i.Gl,{children:`${new Date(e.createdAt).toLocaleTimeString("en-AU",{hour:"2-digit",minute:"2-digit"})}`}),(0,c.jsx)(I,{loading:e.loading,url:n,message:e,prevMessage:s})]},t):(0,c.jsx)(I,{loading:e.loading,url:n,message:e,prevMessage:s},t):null}))]}),(0,c.jsx)(H,{accessToken:t,conversation:k,addMessage:async e=>{x([...h,e])},scrollToBottomConversation:L,bookingRequest:T,userHostModel:q})]})}var N=n(9082),P=n(8306);function E(){const[e,t]=(0,a.useRecoilState)(l.o),[n,d]=(0,a.useRecoilState)(N.H),{id:g}=(0,s.g)(),p=(0,s.Zp)(),[y,m]=(0,o.useState)(!0),[f,v]=(0,o.useState)(null),[j,b]=(0,o.useState)(null),[D,k]=(0,o.useState)(null),[T,A]=(0,o.useState)("https://d292awxalydr86.cloudfront.net/Settings+page/Profile+photo+placeholder.png"),[C,$]=(0,o.useState)(null),S=(0,o.useCallback)((async()=>{"null"!==g&&g&&await(0,r.p)("get","dev-anystay-booking",`conversation/${g}`,{headers:{Authorization:n,conversationId:g}}).then((async e=>{if(e&&e.body.conversation.BookingRequestModel&&e.body.conversation.BookingRequestModel.ListingModel){if(e.body.conversation.UserModel.profilePicture){const t=(0,x.A)(e.body.conversation.UserModel.profilePicture,e.body.conversation.UserModel.identityID,100);A(t)}k(e.body.conversation.UserModel),v(e.body.conversation.BookingRequestModel),b(e.body.conversation.BookingRequestModel.ListingModel),$(JSON.parse(e.body.conversation.BookingRequestModel.hostPriceBreakdown))}else console.log("Conversations related booking or listing has been deleted.")}))}),[g,n]);return(0,o.useEffect)((()=>{e?(async()=>{m(!0),await S(),m(!1)})():p("/")}),[S,p,e]),(0,c.jsxs)(i.f9,{children:[(0,c.jsx)(P.A,{title:"Inbox | Anystay"}),window.innerWidth<768&&(0,c.jsx)(u,{bookingGuestData:D}),(0,c.jsx)(w,{accessToken:n}),window.innerWidth<768&&(0,c.jsx)(M,{bookingRequest:f,listingData:j}),(0,c.jsx)(h,{bookingGuestData:D}),(0,c.jsx)(L,{accessToken:n,guestProfilePictureURL:T}),(0,c.jsx)(R,{bookingRequest:f,bookingGuestData:D,guestProfilePictureURL:T,listingData:j,loadingPage:y,hostPriceBreakdown:C})]})}}}]);
//# sourceMappingURL=8017.f1df6e0f.chunk.js.map
//# debugId=d55f9ac2-de7f-5f98-aadf-2a8e8d5b557b
